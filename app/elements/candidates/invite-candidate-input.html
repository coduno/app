<link rel="import" href="/bower_components/paper-input/all-imports.html">
<link rel="import" href="/bower_components/iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="/bower_components/iron-validatable-behavior/iron-validatable-behavior.html">

<dom-module id="invite-candidate-input">
	<style>
		:host {
			display: block;
		}

		#inputContainer {
			display: table;
		}

		#inputContainer paper-input {
			display: table-cell;
			width: 300px;
		}

		#inputContainer select {
			display: table-cell;
			position: relative;
			bottom: -27px;
			margin-left: 20px;
		}

		#inputContainer p {
			display: table-cell;
			position: relative;
			bottom: -29px;
			padding-left: 10px;
			padding-right: 10px;
		}

		#inputContainer iron-icon {
			display: table-cell;
			position: relative;
			bottom: -15px;
			margin-left: 25px;
			cursor: pointer;
		}
		.invalid{
			border-color: red;
		}
	</style>
	<template>
		<div id="inputContainer">
			<paper-input id="address" label="Address" value="{{candidate.Address}}"></paper-input>
			<template is="dom-if" if="{{isSingleChallenge}}">
				<p>{{challenges.0.Name}}</p>
			</template>
			<template is="dom-if" if="{{!isSingleChallenge}}">
				<select id="challenges" class$={{selectClass}} on-change="_setChallenge">
					<option selected disabled value="">Please select a challenge</option>
					<template is="dom-repeat" items="{{challenges}}">
						<option value="{{item.Key}}">{{item.Name}}</option>
					</template>
				</select>
			</template>
			<iron-icon icon="remove" on-click="_removeItem"></iron-icon>
		</div>
		<br>
	</template>
	<script>
		Polymer({
			is: 'invite-candidate-input',
			behaviors: [
				Polymer.IronFormElementBehavior,
				Polymer.IronValidatableBehavior
			],
			properties: {
				challenges: {
					type: Array
				},
				candidate: {
					type: Object,
					reflectToAttribute: true,
					notify: true
				},
				isSingleChallenge: {
					type: Boolean,
					computed: '_isSingleChallenge(challenges)'
				},
				selectClass: {
					type: String,
				}
			},
			validate: function(){
				var valid = true;
				this.$.address.invalid = false;
				this.selectClass = '';
				if (this.candidate.Challenge === undefined || this.candidate.Challenge === ''){
					this.selectClass = 'invalid';
					valid = false;
				}
				if (!util.validateEmail(this.candidate.Address)){
					this.$.address.invalid = true;
					this.$.address.errorMessage = 'Please input an address according to the format above';
					valid = false;
				}
				return valid;
			},
			_isSingleChallenge: function(challenges){
				return challenges.length === 1;
			},
			_setChallenge: function () {
				this.candidate.Challenge = this.$$('#challenges').options[this.$$('#challenges').selectedIndex].value;
			},
			_removeItem: function () {
				this.fire('removeCandidate', this.candidate);
				this.remove();
			}
		});
	</script>
</dom-module>