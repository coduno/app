<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../../../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../../../bower_components/neon-animation/neon-animatable.html">

<dom-module id="challenge-register-wizard">
	<style include="iron-flex">
		:host{
			display: block;
			height: 100%;
		}
		.horizontal-layout {
			@apply(--layout-horizontal);
		}
		#wrapper {
			@apply(--layout-vertical);
			padding: 24px;
			background: white;
		}
		.icon-text {
			padding: 0 32px 0px 4px;
		}
		#steps {
			background: white;
			height: 30px;
			margin: 16px auto;
			padding: 24px;
			text-align: center;
			width: calc(70% - 48px);
		}
		neon-animated-pages {
			height: calc(100% - 96px);
		}
		#steps-title {
			padding: 0;
			margin: 0;
		}
		#stepElements {
			@apply(--layout-horizontal);
		}
		challenge-info-step {
			position: fixed;
			margin: 16px 0px;
			height: calc(100% - 82px);
		}
	</style>
	<template>
		<challenge-by-canonical-name-provider canonical-name="[[canonicalName]]" data="{{challenge}}"></challenge-by-canonical-name-provider>
		<challenge-register-wizard-nav show-nav="[[showNav]]" first-step-state="[[firstStepState]]"
		second-step-state="[[secondStepState]]"></challenge-register-wizard-nav>
		<neon-animated-pages id="pages" class="flex" selected="[[selected]]" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">
			<challenge-info-step challenge="[[challenge]]"></challenge-info-step>
			<register-page context="[[context]]" on-redirect-login="_login"></register-page>
			<login-wizard context="[[context]]" on-redirect-register="_register"></login-wizard>
			<challenge-register-step user="[[user]]" challenge="[[challenge]]"></challenge-register-step>
		</neon-animated-pages>
	</template>
	<script type="application/javascript" src="../../../../scripts/behaviors/app-connection-behavior.js"></script>
	<script>
		var pageInfo = 0, pageUserRegister = 1, pageLogin = 2, pageChallengeRegister = 3;
		Polymer({
			is: 'challenge-register-wizard',
			behaviors: [
				Behaviors.AppConnection
			],
			properties: {
				selected: {
					type: Number,
					value: 0,
					observer: 'updateNavElements'
				},
				context: {
					value: 'challenge-register'
				},
				entryAnimation: String,
				exitAnimation: String
			},
			listeners: {
				'neon-animation-finish': '_afterNeon',
				'next-step': 'next',
				'prev-step': 'prev'
			},
			ready: function(){
				this.entryAnimation = 'slide-from-right-animation';
				this.exitAnimation = 'slide-left-animation';
			},
			prev: function() {
				if(this.selected === 0){
					return;
				}
				this.entryAnimation = 'slide-from-left-animation';
				this.exitAnimation = 'slide-right-animation';
				this.selected --;
			},
			next: function(e, d) {
				this.entryAnimation = 'slide-from-right-animation';
				this.exitAnimation = 'slide-left-animation';
				if (this.selected === 1) {
					this.$$('challenge-register-step').refresh();
					this.selected = 3;
					this.user = d;
					return;
				}
				if(this.selected === 2 ){
					this._mainApp.setUser(d);
					page('/contest/' + this.challenge.canonicalName + '/info');
					return;
				}
				this.selected++;
			},
			_login: function(){
				this.entryAnimation = 'slide-from-right-animation';
				this.exitAnimation = 'slide-left-animation';
				this.selected = 2;
			},
			_register: function(){
				this.entryAnimation = 'slide-from-left-animation';
				this.exitAnimation = 'slide-right-animation';
				this.selected = 1;
			},
			updateNavElements: function(){
				if(this.selected === 0){
					this.showNav = false;
					return
				}
				this.showNav = true;
				if(this.selected === pageUserRegister || this.selected === pageLogin){
					this.firstStepState = 'current';
					this.secondStepState = 'default';
					this.thirdStepState = 'default';
				}else if (this.selected === pageChallengeRegister){
					this.firstStepState = 'completed';
					this.secondStepState = 'current';
					this.thirdStepState = 'default';
				}
			}
		});
	</script>
</dom-module>
