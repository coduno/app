<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">

<link rel="import" href="explorer-item.html">

<dom-module id="explorer-file">
	<template>
		<style include="iron-flex explorer-item"></style>
		<div id="wrapper" class="item-wrapper">
			<iron-icon icon="assignment"></iron-icon>
			<template is="dom-if" if="{{meta.editMode}}">
				<input id="nameInput" type="text" value="{{newName::input}}" on-keyup="_confirmRename" autofocus>
			</template>
			<template is="dom-if" if="{{!meta.editMode}}">
				<div class="item-name">{{meta.name}}</div>
			</template>
		</div>
		<paper-toast id="toast"></paper-toast>
	</template>
	<script type="application/javascript" src="/scripts/behaviors/file-explorer-item-behavior.js"></script>
	<script>
		Polymer({
			is: 'explorer-file',
			behaviors: [
				Behaviors.FileExplorerItemBehavior
			],
			observers: [
				'_afterMetaSet(meta)'
			],
			listeners: {
				'click': 'selectFile'
			},
			_afterMetaSet: function(){
				if (this.meta.selected){
					this.selectFile();
				}
			},
			selectFile: function(){
				this.fire('file-selected', this);
				this.markSelected();
			},
			getFullName: function(){
				var parent = this.meta.parent.meta;
				var fullName = this.meta.name;
				while(!parent.isRoot){
					fullName = parent.name + '/' + fullName;
					parent = parent.parent.meta;
				}
				return fullName;
			},
			markSelected: function(){
				this.$.wrapper.style.backgroundColor = 'lightgray';
				this.set('meta.selected', true);
			},
			markUnselected: function(){
				this.$.wrapper.style.backgroundColor = '';
				this.set('meta.selected', false);
			},
			getContent: function(){
				return this.meta.content;
			},
			setContent: function(content){
				this.meta.content = content;
			}
		});
	</script>
</dom-module>