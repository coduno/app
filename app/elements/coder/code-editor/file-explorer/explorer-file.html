<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">

<dom-module id="explorer-file">
	<template>
		<style include="iron-flex">
			.file-wrapper:hover {
				background-color: lightgray;
				cursor: pointer;
			}
			.file-wrapper {
				@apply(--layout-horizontal);
				padding: 3px;
			}
			#file-name {
				margin-left: 2px;
			}
			input {
				width: calc(100% - 26px);
			}
		</style>
		<div id="wrapper" class="file-wrapper">
			<iron-icon icon="assignment"></iron-icon>
			<template is="dom-if" if="{{editMode}}">
				<input type="text" value="{{newName::input}}" on-keyup="_confirmRename" autofocus>
			</template>
			<template is="dom-if" if="{{!editMode}}">
				<div id="file-name">{{meta.name}}</div>
			</template>
		</div>
		<paper-toast id="toast"></paper-toast>
	</template>
	<script type="application/javascript" src="/scripts/behaviors/file-explorer-item-behavior.js"></script>
	<script>
		Polymer({
			is: 'explorer-file',
			behaviors: [
				Behaviors.FileExplorerItemBehavior
			],
			observers: [
				'_afterMetaSet(meta)'
			],
			listeners: {
				'click': 'selectFile'
			},
			_afterMetaSet: function(){
				if (this.meta.selected){
					this.selectFile();
				}
			},
			selectFile: function(e){
				this.fire('file-selected', this);
			},
			getFullName: function(){
				var parent = this.meta.parent.meta;
				var fullName = this.meta.name;
				while(!parent.isRoot){
					fullName = parent.name + '/' + fullName;
					parent = parent.parent.meta;
				}
				return fullName;
			},
			markSelected: function(){
				this.$.wrapper.style.backgroundColor = 'lightgray';
				this.meta.selected = true;
			},
			markUnselected: function(){
				this.$.wrapper.style.backgroundColor = '';
				this.meta.selected = false;
			},
			getContent: function(){
				return this.meta.content;
			},
			setContent: function(content){
				this.meta.content = content;
			}
		});
	</script>
</dom-module>