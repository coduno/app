<link rel="import" href="/bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-icons/social-icons.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tab.html">

<link rel="import" href="/elements/common/data-providers/user/user-by-username-provider.html">
<link rel="import" href="/elements/common/skill/skill-polygon.html">
<link rel="import" href="/elements/coder/team/create-team-modal.html">
<link rel="import" href="/elements/coder/team/user-teams-table.html">
<link rel="import" href="/elements/coder/team/user-team-invitations-table.html">

<dom-module id="profile-page">
	<style include="iron-flex iron-flex-reverse">
		:host {
			height: 100%;
		}
		.letter {
			font-size: 16vh;
			color: #4B4F62;
		}
		#top {
			margin-bottom: 16px;
			height: calc(50% - 16px);
			background: white;
			@apply(--layout-horizontal);
		}
		#bottom {
			margin-bottom: 16px;
			height: calc(50% - 16px);
			@apply(--layout-horizontal);
		}
		.left {
			height: 100%;
			margin-right: 8px;
			background: white;
			@apply(--layout-flex)
		}
		.right {
			margin-left: 8px;
			background: white;
			@apply(--layout-flex)
		}
		#userInfo {
			text-align:center;
			@apply(--layout-flex)
			@apply(--layout-vertical)
		}
		#skillPolygonWrapper {
			text-align:center;
			@apply(--layout-flex)
		}
		#wrapper {
			padding-top: 16px; height: calc(100% - 16px);
		}
		.card-header {
			padding: 16px;
		}
		#teamsHeader {
			height: 60px;
			@apply(--layout-horizontal);
		}
		#teamsGrid {
			height: calc(100% - 100px);
		}
		#teamsButtons{
			height: 40px;
			@apply(--layout-horizontal-reverse);
		}
		paper-icon-button {
			@apply(--layout-self-center);
		}
		.teamsContent {
			height: calc(100% - 60px);
		}
		.header{
			background: white;
			color: black;
			height: 100%;
			width: calc(100% - 24px);
		}
	</style>
	<template>
		<user-by-username-provider username="[[username]]" data="{{user}}" with-mocked-skills></user-by-username-provider>

		<div id="wrapper">
			<paper-material id="top" class="mainContent" elevation="1">
				<div id="userInfo">
					<text class="letter">[[user._initialLetter]]</text>
					<h3>[[user.username]]</h3>
					<p>[[user.email]]</p>
					<p>[[user._fullName]]</p>
				</div>
				<div id="skillPolygonWrapper">
					<skill-polygon id="skillPolygon" skills="[[user._mockedSkills]]"></skill-polygon>
				</div>
			</paper-material>
			<div id="bottom" class="mainContent">
				<paper-material class="left" elevation="1">
					<div id="teamsHeader">
						<template is="dom-if" if="[[isCurrentUser]]">
							<paper-tabs selected="{{selectedTab}}" no-ink="true" class="header">
								<paper-tab>Teams</paper-tab>
								<paper-tab>Invitations</paper-tab>
							</paper-tabs>
						</template>
						<template is="dom-if" if="[[!isCurrentUser]]">
							<h3 class="card-header">Teams</h3>
						</template>
					</div>
					<template is="dom-if" if="[[showUserTeams]]">
						<user-teams-table id="teamsGrid" user="[[user]]" is-current-user="[[isCurrentUser]]"></user-teams-table>
						<div id="teamsButtons">
							<paper-button icon="add" on-click="_createTeam">New team</paper-button>
						</div>
					</template>
					<template is="dom-if" if="[[showInvitations]]">
						<user-team-invitations-table class="teamsContent"></user-team-invitations-table>
					</template>
				</paper-material>
				<paper-material class="right" elevation="1">
					<h3 class="card-header">Challenges</h3>
				</paper-material>
			</div>
		</div>

		<create-team-modal id="createTeamDialog" on-team-created="_refreshTeams"></create-team-modal>
	</template>
	<script>
		// NOTE: username needs to be set for data to be shown.
		Polymer({
			is: 'profile-page',
			properties: {
				selectedTab: {
					value: 0
				},
				showUserTeams: {
					computed: '_computeShowUserTeams(isCurrentUser, selectedTab)'
				},
				showInvitations: {
					computed: '_computeShowInvitations(isCurrentUser, selectedTab)'
				}
			},
			_computeShowUserTeams: function(isCurrentUser, selectedTab){
				return !isCurrentUser || selectedTab === 0;
			},
			_computeShowInvitations: function(isCurrentUser, selectedTab){
				return isCurrentUser && selectedTab === 1;
			},
			_createTeam: function(){
				this.$.createTeamDialog.toggle();
			},
			_refreshTeams: function(){
				this.$.teamsGrid.refresh();
			}
		});
	</script>
</dom-module>
