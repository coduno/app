<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="admin-tasks-table">
	<style include="iron-flex">
		:host {
			display: block;
			height: 100%;
		}
		paper-icon-button {
			@apply(--layout-self-center);
		}
	</style>
	<template>
		<tasks-provider data="{{tasks}}"></tasks-provider>
		<vaadin-grid id="runnersTable" class="fullHeight" items="[[tasks]]" visible-rows="5">
			<table>
				<thead>
					<tr>
						<th>Name</th>
						<th>Tag</th>
						<th>Endpoint</th>
						<th>Runner</th>
						<th>Organization</th>
						<th>Options</th>
					</tr>
				</thead>
				<colgroup>
					<col name="name"/>
					<col name="canonicalName"/>
					<col name="endpoint.component"/>
					<col name="runner.path"/>
					<col name="organization.name"/>
					<col name="id" width="120"/>
				</colgroup>
			</table>
		</vaadin-grid>
	</template>
	<script>
		Polymer({
			is: 'admin-tasks-table',
			observers: [
				'_dataChanged(tasks)'
			],
			_dataChanged: function(){
				var element = this;
				this.$.runnersTable.columns[5].renderer = function(cell){
					var team = cell.row.data;
					cell.element.innerHTML = '';
					cell.element.appendChild(element._createIconButton('editor:mode-edit', function(){
						var dialog = element.$.editTeamDialog;
						dialog.team = team;
						dialog.toggle();
						element.clickedOnOption = true;
					}));
					cell.element.appendChild(element._createIconButton('delete', function(){
						var dialog = element.$.deleteTeamDialog;
						dialog.team = team;
						dialog.toggle();
						element.clickedOnOption = true;
					}));
				};
			},
			_createIconButton: function(icon, clickListener){
				var button = document.createElement('paper-icon-button');
				button.icon = icon;
				button.addEventListener('click', clickListener);
				return button;
			}
		});
	</script>
</dom-module>
