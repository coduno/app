<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html">

<dom-module id="editor-console">

  <style>

    paper-toolbar{
      position: relative;
    }

    iron-autogrow-textarea{
      border: none;
      position: relative;
      width: 100%;
      height: 200px;
      max-height: 16%;
      left: 0;
      right: 0;
    }
  </style>

  <template>
    <iron-ajax
      id="ajaxRequest"
      handle-as="json"
      on-response="onresponse"
      debounce-duration="1000"
      content-type="application/json"
      >
    </iron-ajax>

    <paper-toolbar>
      <div class="horizontal layout">

        <button id="runCode" on-click="runcode">Run code</button>

        <select id="programmingLanguage">
          <option>Javascript</option>
          <option>Java</option>
          <option>C#</option>
          <option></option>
        </select>

      </div>
    </paper-toolbar>

    <iron-autogrow-textarea id="console" readonly></iron-autogrow-textarea>

  </template>

  <script>
    Polymer({
      is: 'editor-console',
      properties:{
        testProp: String,
        editor: Object
      },
     ready: function(){
        console.log(this.testProp);
        console.log(this.editor);
      },
      runcode: function(){
        console.log(this.editor.getValue());
        console.log(this.testProp);
        var code = this.editor.getValue();
        this.$.ajaxRequest.method='POST';
        this.$.ajaxRequest.body = JSON.stringify({'code': code, 'language': 'javascript'});
        this.$.ajaxRequest.url='http://localhost:8080/testRoute';
        this.$.ajaxRequest.generateRequest();
      },
      onresponse: function(request){
        console.log(request.detail.response);
        //TODO: dont forget to actually update this when i get a real response
        this.$.console.textarea.value = request.detail.response.code;
      }
    })
  </script>
</dom-module>
