<link rel="import" href="invite-candidate-input.html">
<link rel="import" href="/elements/common/services/user-service.html">

<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="/bower_components/iron-form/iron-form.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="invite-candidates">
	<style include="iron-flex">
		.button-group {
			@apply(--layout-horizontal-reverse);
			margin: 16px;
		}

		#addCandidate {
			margin-top: 10px;
			cursor: pointer;
		}
	</style>
	<template>
		<user-service id="userService"></user-service>

		<p>Start typing the candidates email address</p>
		<form is="iron-form" id="form">
			<template is="dom-repeat" items="{{candidates}}">
				<invite-candidate-input name="inviteCandidateInput" email="{{item}}" required removable="{{multi}}"></invite-candidate-input>
			</template>
		</form>
		<template is="dom-if" if="{{multi}}">
			<div id="addCandidate" on-click="_addCandidate">
				<iron-icon icon="add"></iron-icon>
				<span>Add another candidate</span>
			</div>
		</template>
		<div class="button-group">
			<paper-button id="inviteButton" class="primary" raised on-click="inviteCandidates">Invite</paper-button>
		</div>
	</template>
	<script>
		Polymer({
			is: 'invite-candidates',
			properties: {
				challengeId: {
					notify: true
				},
				candidates: {
					type: Array,
					notify: true,
					value: []
				},
				multi: {
					type: Boolean,
					value: false
				}
			},
			listeners: {
				'candidate-removed': '_removeCandidate',
				'user-invited': '_userInvited'
			},
			reset: function(){
				this._clearCandidates();
				this._addCandidate();
			},
			inviteCandidates: function () {
				if (!this.$.form.validate()){
					return;
				}
				for (var i = 0; i < this.candidates.length; i++) {
					this.$.userService.invite({
						'email': this.candidates[i],
						'challengeId': this.challengeId
					});
				}
			},
			_addCandidate: function () {
				this.push('candidates', '');
			},
			_removeCandidate: function(event){
				var index = this.candidates.indexOf(event.detail);
				this.splice('candidates', index, 1);
			},
			_clearCandidates: function () {
				this.candidates = [];
			},
			_userInvited: function(){
				this.fire('invitation-sent');
			}
		});
	</script>
</dom-module>
