<link rel="import" href="/bower_components/paper-input/all-imports.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-menu/paper-menu.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="/bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="/elements/common/data-providers/user/user-search-provider.html">

<dom-module id="invite-candidate-input">
	<style  include="iron-flex">
		:host {
			display: block;
		}
		#address {
			width: 100%;
			@apply(--layout-self-center);
		}

		iron-icon {
			position: relative;
			bottom: -5px;
			margin-left: 15px;
			cursor: pointer;
			@apply(--layout-self-center);
		}
		#row {
			@apply(--layout-horizontal)
		}
	</style>
	<template>
		<user-search-provider search-string="[[inputValue]]" data="{{users}}"></user-search-provider>
		<div id="row">
			<vaadin-combo-box
				id="address"
				value="{{email}}"
				item-label-path="label"
				item-value-path="email"
				on-input-value-changed="_inputValueChanged"
				allow-custom-value
				items="[[users]]">
			</vaadin-combo-box>
			<template is="dom-if" if="{{removable}}">
				<iron-icon icon="remove" on-click="_removeItem"></iron-icon>
			</template>
		</div>
	</template>
	<script>
		Polymer({
			is: 'invite-candidate-input',
			behaviors: [
				Polymer.IronFormElementBehavior,
				Polymer.IronValidatableBehavior
			],
			properties: {
				email: {
					notify: true
				},
				inputValue: {
					notify: true
				},
				removable: {
					type: Boolean,
					notify: true
				}

			},
			_inputValueChanged: function(e){
				this.inputValue = e.detail;
				this.email = e.detail;
				if (!!this.inputValue && this.inputValue.length < 3){
					this.users = [];
				}
			},
			_removeItem: function () {
				this.fire('candidate-removed', this.email);
			}
		});
	</script>
</dom-module>
